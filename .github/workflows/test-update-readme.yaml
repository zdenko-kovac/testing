name: Update README

on:
  workflow_dispatch:
    inputs:
      system_url:
        description: 'URL of the created system'
        required: true

jobs:
  update_readme:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Get date and actor
      id: meta
      run: |
        echo ::set-output name=date::$(date +%Y-%m-%d)
        echo ::set-output name=actor::$(github.actor)

    - name: Create system
      # Your existing steps to create the system here
      # Remember to output the system URL

    - name: Update README
      id: update_readme
      uses: peaceiris/actions-md-table@v0.3.2
      with:
        markdown: README.md
        table: |
          | Date       | Actor        | System URL      |
          | ---------- | ------------ | --------------- |
          | ${{ steps.meta.outputs.date }} | ${{ steps.meta.outputs.actor }} | ${{ steps.create_system.outputs.system_url }} |

    - name: Commit changes
      run: |
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git config --global user.name "GitHub Actions"
        git add README.md
        git commit -m "Update README with new system URL"
        git push origin HEAD
